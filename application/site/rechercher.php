<?php
/**
 * Created by PhpStorm.
 * User: Pierrot
 * Date: 2018-11-14
 * Time: 12:33
 */
?>

<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
    <link rel="stylesheet" href="../../public/css/reset.css">
    <link rel="stylesheet" href="../../public/css/global.css">
    <script src="../../public/js/jquery-3.3.1.min.js"></script>
</head>
<body>

<div>
    <span id="btnRechercher"><i class="fas fa-search"></i></span>
</div>

    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dicta inventore labore quis ullam. Accusantium aliquam consectetur corporis doloremque eligendi fuga harum minus, molestiae nemo, optio pariatur placeat provident quo ratione?</p>




<div id="rechercher-container" class="flex-container">
    <div id="rechercher-form">
        <form action="rechercher.php" method="POST">
            <span></span>
            <input type="text" placeholder="Rechercher" autofocus>
        </form>
        <span><i class="fas fa-times fa-2x"></i></span>
    </div>
    <div id="resultats-container" class="flex-container">
        <div id="rechercher-resultats" class="flex-container">
            <div id="resultats-auteurs" class="resultats">
                <span>Auteur</span>
                <ul>

                </ul>
            </div>
            <div id="resultats-textes" class="resultats">
                <span>Textes</span>
                <ul>

                </ul>
            </div>

            <div id="resultats-medias" class="flex-container">
                <div id="resultats-img" class="resultats">
                    <span>Medias</span>
                    <ul>

                    </ul>
                </div>
                <div id="resultats-sons" class="resultats">
                    <span>Sons</span>
                    <ul>

                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div id="loading">
        <img src="../../public/medias/loading.gif" alt="">
    </div>
</div>

<script>
    (function(){
        var txtRecherche = document.querySelector("form input[type=text]");
        var aSouligne = document.querySelector("#rechercher-form form>span");
        var btnClose = document.querySelector("#rechercher-form>span");
        var panRechercher = document.querySelector("#rechercher-container");
        var btnRechercher = document.getElementById("btnRechercher");

        btnRechercher.addEventListener("click", OuvrirRechercher);

        btnClose.addEventListener("click", FermerRechercher);

        txtRecherche.addEventListener("input", function () {
            aSouligne.innerHTML = txtRecherche.value;

            // Si la boite de texte n'est pas vide,
            if(txtRecherche.value !== ""){

                // AJAX
                $.ajax({
                    url: "../controleurs/ajax/gererRecherche.php",
                    data: {sTerme : txtRecherche.value},
                    method: "post",
                    beforeSend: function() {
                        // Retirer tous les résultats précédents
                        document.querySelector("#resultats-textes ul").innerHTML = "";
                        document.querySelector("#resultats-auteurs ul").innerHTML = "";
                        document.querySelector("#resultats-img ul").innerHTML = "";
                        document.querySelector("#resultats-sons ul").innerHTML = "";

                        // Mettre une icone de chargement
                        document.getElementById("loading").style.display = "flex";
                    }
                })
                // Si la reqête est terminée
                    .done(function (sHtml) {

                        // Enlever l'icone de chargement
                        document.getElementById("loading").style.display = "none";

                        // Récupérer le JSON et transformer en objet JS
                        oJson = JSON.parse(sHtml);

                        // Afficher les résultats
                        afficherResultatsTexte(oJson);
                    });


                document.getElementById("rechercher-resultats").style.display = "flex";
                document.getElementById("resultats-container").style.backgroundColor = "rgba(38, 38, 38, 0.98)";
            }
            else{
                document.getElementById("rechercher-resultats").style.display = "none";
                document.getElementById("resultats-container").style.backgroundColor = "rgba(255, 255, 255, 0.98)";
            }
        });


        function OuvrirRechercher(){
            panRechercher.style.display = "flex";
            txtRecherche.focus();
        }
        function FermerRechercher(){
            panRechercher.style.display = "none";
        }

        function afficherResultatsTexte(aJson){
            var sHtml = "";

            // Textes
            if(aJson[0].length > 0){
                for(var i=0; i<aJson[0].length; i++){
                    sHtml += "<li><a href='#'><span>"+ aJson[0][i].sTitreTexte +"</span><span>"+ aJson[0][i].sPrenomAuteur +" " +  aJson[0][i].sNomAuteur +"</span></a></li>";
                }
            }
            else{
                sHtml = "<li>Aucun résultat.</li>";
            }
            document.querySelector("#resultats-textes ul").innerHTML = sHtml;
            sHtml = "";

            // Auteurs
            if(aJson[1].length > 0){
                for(var i=0; i<aJson[1].length; i++){
                    sHtml += "<li><a href='#'>"+ aJson[1][i].sPrenomAuteur +" "+ aJson[1][i].sNomAuteur +"</a></li>";
                }
            }
            else{
                sHtml = "<li>Aucun résultat.</li>";
            }
            document.querySelector("#resultats-auteurs ul").innerHTML = sHtml;
            sHtml = "";

            // Medias img
            if(aJson[2].length > 0){
                sHtml = "";

                for(var i=0; i<aJson[2].length; i++){
                    sHtml += "<li><a href='#'><span>"+ aJson[2][i].sTitreMedia +"</span><span>"+ aJson[2][i].sPrenomAuteur +" " +  aJson[2][i].sNomAuteur +"</span></a></li>";
                }
            }
            else{
                sHtml = "<li>Aucun résultat.</li>";
            }
            document.querySelector("#resultats-img ul").innerHTML = sHtml;
            sHtml = "";

            // Medias sons
            if(aJson[3].length > 0){


                for(var i=0; i<aJson[3].length; i++){
                    sHtml += "<li><a href='#'><span>"+ aJson[3][i].sTitreMedia +"</span><span>"+ aJson[3][i].sPrenomAuteur +" " +  aJson[3][i].sNomAuteur +"</span></a></li>";
                }
            }
            else{
                sHtml = "<li>Aucun résultat.</li>";
            }

            document.querySelector("#resultats-sons ul").innerHTML = sHtml;
            sHtml = "";
        }

    })();

</script>

</body>
</html>
